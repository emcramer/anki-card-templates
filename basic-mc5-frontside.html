<!-- Import Anki Persistence to keep cards consistent across front and back -->
<script>
    // Loading Persistence
    // https://github.com/SimonLammer/anki-persistence
    // v0.5.2 - https://github.com/SimonLammer/anki-persistence/blob/62463a7f63e79ce12f7a622a8ca0beb4c1c5d556/script.js
    if (void 0 === window.Persistence) { var _persistenceKey = "github.com/SimonLammer/anki-persistence/", _defaultKey = "_default"; if (window.Persistence_sessionStorage = function () { var e = !1; try { "object" == typeof window.sessionStorage && (e = !0, this.clear = function () { for (var e = 0; e < sessionStorage.length; e++) { var t = sessionStorage.key(e); 0 == t.indexOf(_persistenceKey) && (sessionStorage.removeItem(t), e--) } }, this.setItem = function (e, t) { void 0 == t && (t = e, e = _defaultKey), sessionStorage.setItem(_persistenceKey + e, JSON.stringify(t)) }, this.getItem = function (e) { return void 0 == e && (e = _defaultKey), JSON.parse(sessionStorage.getItem(_persistenceKey + e)) }, this.removeItem = function (e) { void 0 == e && (e = _defaultKey), sessionStorage.removeItem(_persistenceKey + e) }) } catch (e) { } this.isAvailable = function () { return e } }, window.Persistence_windowKey = function (e) { var t = window[e], i = !1; "object" == typeof t && (i = !0, this.clear = function () { t[_persistenceKey] = {} }, this.setItem = function (e, i) { void 0 == i && (i = e, e = _defaultKey), t[_persistenceKey][e] = i }, this.getItem = function (e) { return void 0 == e && (e = _defaultKey), t[_persistenceKey][e] || null }, this.removeItem = function (e) { void 0 == e && (e = _defaultKey), delete t[_persistenceKey][e] }, void 0 == t[_persistenceKey] && this.clear()), this.isAvailable = function () { return i } }, window.Persistence = new Persistence_sessionStorage, Persistence.isAvailable() || (window.Persistence = new Persistence_windowKey("py")), !Persistence.isAvailable()) { var titleStartIndex = window.location.toString().indexOf("title"), titleContentIndex = window.location.toString().indexOf("main", titleStartIndex); titleStartIndex > 0 && titleContentIndex > 0 && titleContentIndex - titleStartIndex < 10 && (window.Persistence = new Persistence_windowKey("qt")) } }
</script>

<!--- State the question on the front side --->
<div id="Front">{{Question}}</div>
<br/>
<!-- Table to hold the answer choices -->
<div id="answers_table"></div>

<div class="hidden" id="Q_1">{{A1}}</div>
<div class="hidden" id="Q_2">{{A2}}</div>
<div class="hidden" id="Q_3">{{A3}}</div>
<div class="hidden" id="Q_4">{{A4}}</div>
<div class="hidden" id="Q_5">{{A5}}</div>
<br/>

<script>
//function to shuffle array
function shuffle(array) {
  var currentIndex = array.length,
    temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

//generate a table to hold the answer choices
function generateTable() {
  var myTableDiv = document.getElementById("answers_table");

  var table = document.createElement('TABLE');
  table.border = '1';

  var tableBody = document.createElement('TBODY');
  table.appendChild(tableBody);

  var arr = []; //decalre arrary for answer choices

  for (var i = 0; i < 5; i++) {
    arr[i] = document.getElementById("Q_" + (i + 1)).textContent;
  }

  console.log(arr);
  //shuffle the array
  arr = shuffle(arr);
  console.log(arr);

/*
This is not working,  likely changes to Anki have broken the persistence library
// store the shuffled array with Anki Persistence
if (Persistence.isAvailable()) {  // Check whether Persistence works on the client.
   my_arr = Persistence.getItem(); // Retrieve a previously stored array and override the default. (In case this is executed on the backside as well by {{FrontSide}})
  if (my_arr == null) {           // If there was no array stored previously:
		Persistence.clear();
        Persistence.setItem('user_answers', document.getElementById("answers_table").innerHTML);
    my_arr = arr;      //   1. Create a random number and override the default.
    Persistence.setItem('arr',  my_arr);  //   2. Store the array
  }
}
*/


  // array for the answer choice labels (ABCDE)
  var LETTERS = ["A", "B", "C", "D", "E"]

// generate the table and populate it with randomized answers
  for (var i = 0; i < arr.length; i++) {
    var tr = document.createElement('TR');
    tableBody.appendChild(tr);
    var td = document.createElement('TD');
    //td.width = '75';
    td.appendChild(document.createTextNode(LETTERS[i] + ". " + arr[i]));
    tr.appendChild(td);
  }

//add the table to the card
  myTableDiv.appendChild(table);

}

// wrapper for table generation
function run() {
  generateTable();
}

// let's go!
run();

</script>